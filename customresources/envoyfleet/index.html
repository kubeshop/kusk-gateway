
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OpenAPI for Kubernetes done right">
      
      
        <meta name="author" content="Kubeshop Kusk team">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Envoy Fleet - Kusk Gateway</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/base.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-204665550-4","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#envoy-fleet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kusk Gateway" class="md-header__button md-logo" aria-label="Kusk Gateway" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kusk Gateway
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Envoy Fleet
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kubeshop/kusk-gateway" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubeshop/kusk-gateway
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kusk Gateway" class="md-nav__button md-logo" aria-label="Kusk Gateway" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Kusk Gateway
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kubeshop/kusk-gateway" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubeshop/kusk-gateway
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        Installing Kusk Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/deploy-an-api/" class="md-nav__link">
        Deploy an OpenAPI definition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/connect-a-service-to-the-api/" class="md-nav__link">
        Connect a Service to the API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/working-with-extension/" class="md-nav__link">
        OpenAPI Extension
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/mocking/" class="md-nav__link">
        Mocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/cors/" class="md-nav__link">
        CORS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/routing/" class="md-nav__link">
        Routing & Disabling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/timeouts/" class="md-nav__link">
        Timeouts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/basic-auth/" class="md-nav__link">
        Basic Auth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/rate-limit/" class="md-nav__link">
        Rate Limiting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/cache/" class="md-nav__link">
        Caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/cert-manager/" class="md-nav__link">
        Using Cert Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Kusk CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kusk CLI" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Kusk CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/overview/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/install-cmd/" class="md-nav__link">
        Install Kusk Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/generate-cmd/" class="md-nav__link">
        Generating API CRDs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/mock-cmd/" class="md-nav__link">
        Mocking your API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/dashboard-cmd/" class="md-nav__link">
        Accessing Kusk Gateway's Dashboard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Kusk Dashboard
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kusk Dashboard" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Kusk Dashboard
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dashboard/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dashboard/inspecting-apis/" class="md-nav__link">
        Inspecting APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dashboard/deploying-apis/" class="md-nav__link">
        Deploying APIs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Kusk Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kusk Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Kusk Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Envoy Fleet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Envoy Fleet
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../staticroute/" class="md-nav__link">
        Static Route
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/extension/" class="md-nav__link">
        OpenAPI Extension
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/openapi/" class="md-nav__link">
        Dashboard API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/development/" class="md-nav__link">
        Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../privacy/" class="md-nav__link">
        Privacy Policy
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/kubeshop/kusk-gateway/blob/main/docs/customresources/envoyfleet.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="envoy-fleet">Envoy Fleet</h1>
<p>This resource defines the Envoy Fleet, which is the implementation of the gateway in Kubernetes based on Envoy Proxy.</p>
<p>Once the resource manifest is deployed to Kubernetes, it is used by Kusk Gateway Manager to set up K8s Envoy Proxy <strong>Deployment</strong>, 
<strong>ConfigMap</strong> and <strong>Service</strong>.</p>
<p>The <strong>ConfigMap</strong> config bootstraps Envoy Proxy to connect to the <a href="https://www.envoyproxy.io/docs/envoy/latest/api-docs/xds_protocol">XDS</a> service of the KGW Manager to retrieve the configuration.
In its initial state there is a minimal configuration, you have to deploy API or StaticRoute resource to set up the routing.</p>
<p>If the Custom Resource is uninstalled, the Manager deletes the created K8s resources.</p>
<p>You can deploy multiple Envoy Fleets and have multiple Gateways available.</p>
<p>Once the Fleet is deployed, its <strong>status</strong> field shows the success of the process (Deployed, Failed), so it can be shown with <code>kubectl describe envoyfleet</code> command.</p>
<h2 id="limitations"><strong>Limitations</strong></h2>
<p>Currently, only the success of K8s resources deployment is shown, not if the Envoy Proxy pods are alive or if the Service has the External IP Address allocated.</p>
<p><strong>Supported parameters:</strong></p>
<ul>
<li>
<p>metadata.<strong>name</strong> and metadata.<strong>namespace</strong> - Used as the Envoy Fleet ID. The Manager will supply the configuration for this specific ID - Envoy will connect to the KGW Manager with it. API/Static Route can be deployed to this fleet using their fleet name field.</p>
</li>
<li>
<p>spec.<strong>image</strong> - The Envoy Proxy container image tag, usually envoyproxy/envoy-alpine.</p>
</li>
<li>
<p>spec.<strong>service</strong> - Defines the configuration of the K8s Service that exposes the Envoy Proxy deployment. It is similar to the K8s Service configuration but with a limited set of fields.</p>
</li>
<li>
<p>spec.service.<strong>type</strong> - Select the Service Type (NodePort, ClusterIP, LoadBalancer).</p>
</li>
<li>
<p>spec.service.<strong>ports</strong> - Expose TCP ports (80, 443 or any other) routed to the ports names that Deployment exposes (http, https); ports to which the Envoy Proxy listener binds.</p>
</li>
<li>
<p>spec.service.<strong>annotations</strong> - Add annotations to the Service that will control load balancer configuration in the specific cloud providers implementations (e.g. to set up the internal Google Cloud Platform load balancer in the Google Cloud Engine, we annotate Service with the related annotation).</p>
</li>
<li>
<p>spec.service.<strong>loadBalancerIP</strong> - Used to specify the pre-allocated Load Balancer IP address so it won't be deleted in case the Service is deleted.</p>
</li>
<li>
<p>spec.service.<strong>externalTrafficPolicy</strong> - Optional parameter that denotes if this Service routes external traffic to node-local or cluster-wide endpoints. <strong>Local</strong> preserves the client source IP and avoids a second hop for LoadBalancer and Nodeport type services, but risks potentially imbalanced traffic spreading. <strong>Cluster</strong> obscures the client source IP and may cause a second hop to another node, but should have good overall load-spreading. For the preservation of the real client IP in access logs, choose "Local"</p>
</li>
<li>
<p>spec.<strong>size</strong> - Optional parameter to specify the number of Envoy Proxy pods in the K8s deployment. If not specified, defaults to 1.</p>
</li>
<li>
<p>spec.<strong>resources</strong> - Optional parameter that configures the Envoy Proxy container CPU/Memory requests and limits. Read <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Resource Management for Pods and Containers</a> for the details. By default, no requests or limits are specified.</p>
</li>
<li>
<p>spec.<strong>annotations</strong> - Optional parameter that adds additional annotations to the Envoy Proxy pods, e.g. for Prometheus scraping.</p>
</li>
<li>
<p>spec.<strong>nodeSelector</strong>, spec.<strong>tolerations</strong> and spec.<strong>affinity</strong> - Optional parameters that provide the Envoy Proxy deployment settings for the K8s Pod scheduler. Read <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">Assigning Pods to Nodes</a> to understand how can you bind Envoy pods to some types of nodes (e.g. non-preemtible node type pool) and how to ensure that Envoy pods are placed onto the different nodes for High Availability. See the YAML example below, too. The structure of these fields are the same as for K8s Deployment. These options can be used simultaneously, influencing each other.</p>
</li>
<li>
<p>spec.<strong>accesslog</strong> - Optional parameter that defines Envoy Proxy stdout HTTP requests logging. Each Envoy pod can stream the access log to stdout. If not specified,  no streaming occurs. If specified, you must chose the <strong>format</strong> and, optionally, the text or JSON template to tune the output.</p>
</li>
<li>
<p>spec.accesslog.<strong>format</strong> - Required parameter that specifies the format of the output: <strong>JSON</strong> (structured) or <strong>text</strong>. Note that JSON format doesn't preserve fields order.</p>
</li>
<li>
<p>spec.accesslog.<strong>text_template</strong>|<strong>json_template</strong> - Optional parameters that could be used to specify the exact Envoy request data to log. See <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#config-access-log-format-strings">Envoy's Access Logging</a> for the details. If not specified, Kusk Gateway provided defaults.</p>
</li>
<li>
<p>spec.<strong>tls</strong> - Optional parameter that defines TLS settings for the Envoy Fleet. If not specified, the Envoy Fleet will accept only HTTP traffic.</p>
</li>
<li>
<p>spec.tls.<strong>cipherSuites</strong> - An optional field that, when specified, the TLS listener will only support the specified cipher list when negotiating TLS 1.0 or 1.2 (this setting has no effect when negotiating TLS 1.3). If not specified, a default list will be used. Defaults are different for server (downstream) and client (upstream) TLS configurations. For more information see: <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto">Envoy's Common TLS Configuration</a>.</p>
</li>
<li>
<p>spec.tls.<strong>tlsMinimumProtocolVersion</strong> - An optional field specifying the minimum TLS protocol version. By default, TLSv1_2 for clients and TLSv1_0 for servers.</p>
</li>
<li>
<p>spec.tls.<strong>tlsMaximumProtocolVersion</strong> - An optional field specifying the maximum TLS protocol version. By default, TLSv1_2 for clients and TLSv1_3 for servers.</p>
</li>
<li>
<p>spec.tls.<strong>https_redirect_hosts</strong> - An optional field specifying the domain names to force use of HTTPS with. Non-secure HTTP requests with the matched Host header will be automatically redirected to secure HTTPS with the "301 Moved Permanently" code.</p>
</li>
<li>
<p>spec.tls.<strong>tlsSecrets</strong> - Secret name and namespace combinations for locating TLS secrets containing TLS certificates. More than one may be specified.
Kusk Gateway Manager pulls the certificates from the secrets, extracts the matching hostnames from the SubjectAlternativeNames (SAN) certificate field and configures Envoy to use that certificate for those hostnames.</p>
</li>
<li>
<p>spec.tls.tlsSecrets.<strong>secretRef</strong> - The name of the Kubernetes secret containing the TLS certificate.</p>
</li>
<li>
<p>spec.tls.tlsSecrets.<strong>namespace</strong> - The namespace where the Kubernetes secret resides.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway.kusk.io/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EnvoyFleet</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;envoyproxy/envoy-alpine:v1.20.0&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># NodePort, ClusterIP, LoadBalancer</span><span class="w"></span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Specify annotations to modify service behaviour, e.g. for GCP to create internal load balancer:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># annotations:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   networking.gke.io/load-balancer-type: &quot;Internal&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Specify preallocated static load balancer IP address if present</span><span class="w"></span>
<span class="w">    </span><span class="c1">#loadBalancerIP: 10.10.10.10</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">  </span><span class="c1"># externalTrafficPolicy: Cluster|Local</span><span class="w"></span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># limits:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   cpu: 1</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   memory: 100M</span><span class="w"></span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span><span class="w"></span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100M</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Put any additional annotations to the Enovy pod.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Here we add the annotations for the Prometheus service discovery to scrape Envoy pods for the Prometheus metrics.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># annotations:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   prometheus.io/scrape: &#39;true&#39;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   prometheus.io/port: &#39;19000&#39;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   prometheus.io/path: /stats/prometheus</span><span class="w"></span>

<span class="w">  </span><span class="c1">##### Scheduling directives</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Read https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/ for the details.</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Optional - schedule Envoy pods to the node with the label &quot;disktype=ssd&quot;.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># nodeSelector:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   disktype: &quot;ssd&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Optional - allow to be scheduled on the &quot;tainted&quot; node. Taint with &quot;kubectl taint nodes node1 key1=value1:NoSchedule&quot;.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Taints will repel the pods from the node unless the pods have the specific toleration.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># The line below will allow this specific Envoy pod to be scheduled there (but scheduler decideds where to put it anyway).</span><span class="w"></span>
<span class="w">  </span><span class="c1"># tolerations:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># - key: &quot;key1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   operator: &quot;Exists&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   effect: &quot;NoSchedule&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Optional - provide pods affinity and anti-affinity settings.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># This is more flexible than nodeSelector scheme, but they can be specified together.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># For the scalability and fault tolerance we prefer to put all Envoy pods onto different nodes - in a case one node fails we survive on others.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># The block below will search for all matching labels of THIS &quot;default&quot; envoy fleet pods and will try to schedule pods onto different nodes.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Other fleets (if present) are not taken into consideration. You can specify nodeAffinity and podAffinity as well.</span><span class="w"></span>
<span class="w">  </span><span class="c1"># affinity:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#   podAntiAffinity:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#     requiredDuringSchedulingIgnoredDuringExecution:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#     - labelSelector:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#         matchExpressions:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#         - key: app.kubernetes.io/name</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           operator: In</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           values:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           - kusk-gateway-envoy-fleet</span><span class="w"></span>
<span class="w">  </span><span class="c1">#         - key: fleet</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           operator: In</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           values:</span><span class="w"></span>
<span class="w">  </span><span class="c1">#           - default</span><span class="w"></span>
<span class="w">  </span><span class="c1">#       topologyKey: kubernetes.io/hostname</span><span class="w"></span>

<span class="w">  </span><span class="c1"># optional, the number of Envoy Proxy pods to start</span><span class="w"></span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>

<span class="w">  </span><span class="c1"># Access logging to stdout</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Optional, if this is missing no access logging to stdout will be done</span><span class="w"></span>
<span class="w">  </span><span class="nt">accesslog</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># json|text</span><span class="w"></span>
<span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Depending on format we can specify our own log template or if template is not specified - default Kusk Gateway will be used.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># See https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#config-access-log-format-strings for the details.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Below are specified the examples of similar and minimalistic formats for both text and json format types.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Text format fields order is preserved.</span><span class="w"></span>
<span class="w">    </span><span class="c1"># The output example:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># &quot;[2021-12-15T16:50:50.217Z]&quot; &quot;GET&quot; &quot;/&quot; &quot;200&quot; &quot;1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">text_template</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">      </span><span class="no">&quot;[%START_TIME%]&quot; &quot;%REQ(:METHOD)%&quot; &quot;%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%&quot; &quot;%RESPONSE_CODE%&quot; &quot;%DURATION%&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Json format fields order isn&#39;t preserved</span><span class="w"></span>
<span class="w">    </span><span class="c1"># The output example:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># {&quot;start_time&quot;:&quot;2021-12-15T16:46:52.135Z&quot;,&quot;path&quot;:&quot;/&quot;,&quot;response_code&quot;:200,&quot;method&quot;:&quot;GET&quot;,&quot;duration&quot;:1}</span><span class="w"></span>
<span class="w">    </span><span class="nt">json_template</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">start_time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%START_TIME%&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%REQ(:METHOD)%&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">response_code</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%RESPONSE_CODE%&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%DURATION%&quot;</span><span class="w"></span>

<span class="w">  </span><span class="c1"># TLS configuration</span><span class="w"></span>
<span class="w">  </span><span class="c1"># tls:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># cipherSuites:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - ECDHE-ECDSA-AES128-SHA</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - ECDHE-RSA-AES128-SHA</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - AES128-GCM-SHA256</span><span class="w"></span>
<span class="w">    </span><span class="c1"># tlsMinimumProtocolVersion: TLSv1_2</span><span class="w"></span>
<span class="w">    </span><span class="c1"># tlsMaximumProtocolVersion: TLSv1_3</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https_redirect_hosts:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#     - &quot;example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1">#     - &quot;my-other-example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># tlsSecrets:</span><span class="w"></span>
<span class="w">    </span><span class="c1">#   - secretRef: my-cert</span><span class="w"></span>
<span class="w">    </span><span class="c1">#     namespace: default</span><span class="w"></span>
</code></pre></div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../api/" class="md-footer__link md-footer__link--prev" aria-label="Previous: API" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              API
            </div>
          </div>
        </a>
      
      
        
        <a href="../staticroute/" class="md-footer__link md-footer__link--next" aria-label="Next: Static Route" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Static Route
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 <a href="https://kubeshop.io">Kubeshop</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>