"use strict";(self.webpackChunkkusk_gateway_docs_2=self.webpackChunkkusk_gateway_docs_2||[]).push([[5185],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=a.createContext({}),p=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(n),h=i,m=d["".concat(u,".").concat(h)]||d[h]||c[h]||r;return n?a.createElement(m,o(o({ref:t},s),{},{components:n})):a.createElement(m,o({ref:t},s))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},44395:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const r={},o="JWT Authentication",l={unversionedId:"guides/authentication/jwt",id:"guides/authentication/jwt",title:"JWT Authentication",description:"Kusk allows you to protect your APIs in Kubernetes using JWT. In this guide you'll learn how to add JWT authentication to your API.",source:"@site/docs/guides/authentication/jwt.md",sourceDirName:"guides/authentication",slug:"/guides/authentication/jwt",permalink:"/guides/authentication/jwt",draft:!1,editUrl:"https://github.com/kubeshop/kusk-gateway/docs/guides/authentication/jwt.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Cloudentity",permalink:"/guides/authentication/cloudentity"},next:{title:"CORS Settings",permalink:"/guides/cors"}},u={},p=[{value:"Example",id:"example",level:2},{value:"1. Create an Auth0 JWT authentication",id:"1-create-an-auth0-jwt-authentication",level:3},{value:"2. Deploy an API application to your Kubernetes cluster",id:"2-deploy-an-api-application-to-your-kubernetes-cluster",level:3},{value:"3. Create the OpenAPI definition to expose your API using Kusk",id:"3-create-the-openapi-definition-to-expose-your-api-using-kusk",level:3},{value:"4. Get a token from Auth0",id:"4-get-a-token-from-auth0",level:3},{value:"5. Test your authenticated API",id:"5-test-your-authenticated-api",level:3},{value:"Example without Bearer token specified",id:"example-without-bearer-token-specified",level:4},{value:"Example with invalid Bearer token",id:"example-with-invalid-bearer-token",level:4},{value:"Your API is now authenticated!",id:"your-api-is-now-authenticated",level:3}],s={toc:p};function c(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},s,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"jwt-authentication"},"JWT Authentication"),(0,i.kt)("p",null,"Kusk allows you to protect your APIs in Kubernetes using JWT. In this guide you'll learn how to add JWT authentication to your API."),(0,i.kt)("p",null,"For the purposes of this example, we're using Auth0's JWT authentication."),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)("h3",{id:"1-create-an-auth0-jwt-authentication"},"1. Create an Auth0 JWT authentication"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Signup for an account at ",(0,i.kt)("a",{parentName:"p",href:"https://auth0.com/"},"Auth0"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create an Auth0 API Application. Go to Applications > APIs\n",(0,i.kt)("img",{alt:"auth0 create API",src:n(26291).Z,width:"1644",height:"415"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure the following Auth0 Application fields: "),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Name (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"example-api"),")"),(0,i.kt)("li",{parentName:"ol"},"Identifier (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"https://example-api"),")"),(0,i.kt)("li",{parentName:"ol"},"Signing algorithm: RS256")))),(0,i.kt)("p",null,"Take note of your Auth0 domain, which you can find here: "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"auth0 get domain",src:n(80213).Z,width:"1019",height:"846"})),(0,i.kt)("h3",{id:"2-deploy-an-api-application-to-your-kubernetes-cluster"},"2. Deploy an API application to your Kubernetes cluster"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl create deployment hello-world --image=kubeshop/kusk-hello-world:v1.0.0\nkubectl expose deployment hello-world --name hello-world-svc --port=8080\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="Expected output"',title:'"Expected','output"':!0},"deployment.apps/hello-world created\nservice/hello-world-svc exposed\n")),(0,i.kt)("h3",{id:"3-create-the-openapi-definition-to-expose-your-api-using-kusk"},"3. Create the OpenAPI definition to expose your API using Kusk"),(0,i.kt)("p",null,"A minimal example of the configuration for the JWT filter is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="api.yaml"',title:'"api.yaml"'},"openapi: 3.1.0\ninfo:\n  title: jwt-oauth0\n  description: jwt-oauth0\n  version: 0.1.0\nx-kusk:\n  upstream:\n    service:\n      name: hello-world-svc\n      namespace: default\n      port: 8080\n  auth:\n    jwt:\n      providers:\n        - name: kusk-gateway-jwt\n          issuer: $ISSUER_URL\n          audiences:\n            - $JWT_AUDIENCE\n          jwks: $JWKS_URL\npaths:\n  /hello:\n    get:\n      description: Returns a hello world greeting\n      operationId: /hello\n      responses: {}\n")),(0,i.kt)("p",null,"You are required to change:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"issuer")," (for example: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://$AUTH0_DOMAIN"),")"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"audiences")," (for example: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://$AUTH0_IDENTIFIER"),", you can get the Identifier field from the Settings tab)"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"jwks")," (for example: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://$AUTH0_DOMAIN/.well-known/jwks.json"),")")),(0,i.kt)("p",null,"After that, deploy the API by running: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kusk deploy -i api.yaml\n")),(0,i.kt)("h3",{id:"4-get-a-token-from-auth0"},"4. Get a token from Auth0"),(0,i.kt)("p",null,"The best way to get a token to test authentication with from Auth0 is using the ",(0,i.kt)("inlineCode",{parentName:"p"},"curl")," command they offer in the test tab: "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"auth0 get curl command",src:n(72692).Z,width:"1117",height:"672"})),(0,i.kt)("p",null,"Run the ",(0,i.kt)("inlineCode",{parentName:"p"},"curl")," command and take note of the token: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'curl --request POST \\\n  --url https://aabedraba.eu.auth0.com/oauth/token \\\n  --header \'content-type: application/json\' \\\n  --data \'{"client_id":"$CLIENT_ID","client_secret":"$CLIENT_SECRET","audience":"https://example-api","grant_type":"client_credentials"}\'\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="Expected output"',title:'"Expected','output"':!0},'{"access_token":"TOKEN_TO_COPY","expires_in":86400,"token_type":"Bearer"}\n')),(0,i.kt)("h3",{id:"5-test-your-authenticated-api"},"5. Test your authenticated API"),(0,i.kt)("p",null,"Get the IP address of Kusk by running: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"kusk ip\n\n> 12.34.56.78\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"curl -H 'Authorization: Bearer \"YOUR_TOKEN\"' 12.34.56.78/hello\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="Expected output"',title:'"Expected','output"':!0},'{\n    "message": "Hello from an implemented service!"\n}\n')),(0,i.kt)("h4",{id:"example-without-bearer-token-specified"},"Example without Bearer token specified"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"curl 12.34.56.78/hello\n\n> Jwt is missing\n")),(0,i.kt)("h4",{id:"example-with-invalid-bearer-token"},"Example with invalid Bearer token"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"curl -H 'Authorization: Bearer invalid-token' 12.34.56.78/hello\n\n> Jwt header is an invalid JSONShould pass since Bearer token is present\n")),(0,i.kt)("h3",{id:"your-api-is-now-authenticated"},"Your API is now authenticated!"),(0,i.kt)("p",null,"With Kusk, authenticating your APIs using JWT tokens is as easy as adding an extension to your OpenAPI definition. Stay safe out there!"))}c.isMDXComponent=!0},26291:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jwt-auth0-create-api-cdf482969d77ec0c50996a59e0f845d3.png"},72692:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jwt-auth0-curl-3f10fa842da598590bfa8ca347d71f11.png"},80213:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jwt-auth0-domain-486da5e3cac92d27db8626c0784ab9cf.png"}}]);