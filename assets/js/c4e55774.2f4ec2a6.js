"use strict";(self.webpackChunkkusk_gateway_docs_2=self.webpackChunkkusk_gateway_docs_2||[]).push([[500],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),k=s(a),u=r,h=k["".concat(p,".").concat(u)]||k[u]||m[u]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=k;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},3555:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const i={},o="OpenAPI Extension Reference",l={unversionedId:"extension",id:"extension",title:"OpenAPI Extension Reference",description:"Kusk Gateway comes with an OpenAPI extension to accommodate everything within",source:"@site/docs/extension.md",sourceDirName:".",slug:"/extension",permalink:"/extension",draft:!1,editUrl:"https://github.com/kubeshop/kusk-gateway/docs/extension.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/getting-started"},next:{title:"The Kusk OpenAPI Extension",permalink:"/guides/working-with-extension"}},p={},s=[{value:"<strong>Available Properties</strong>",id:"available-properties",level:2},{value:"<strong>Hosts</strong>",id:"hosts",level:3},{value:"<strong>CORS</strong>",id:"cors",level:3},{value:"<strong>QoS</strong>",id:"qos",level:3},{value:"<strong>Websocket</strong>",id:"websocket",level:3},{value:"<strong>Upstream</strong>",id:"upstream",level:3},{value:"<strong>Rewrite</strong>",id:"rewrite",level:4},{value:"<strong>Service</strong>",id:"service",level:4},{value:"<strong>Host</strong>",id:"host",level:4},{value:"<strong>Path</strong>",id:"path",level:3},{value:"<strong>Redirect</strong>",id:"redirect",level:3},{value:"<strong>Validation</strong>",id:"validation",level:3},{value:"<strong>Mocking</strong>",id:"mocking",level:3},{value:"<strong>Rate limiting</strong>",id:"rate-limiting",level:3},{value:"<strong>Caching</strong>",id:"caching",level:3},{value:"<strong>Authentication</strong>",id:"authentication",level:3},{value:"References",id:"references",level:4},{value:"<code>basic</code> Sample",id:"basic-sample",level:4},{value:"<code>oauth2</code> Sample",id:"oauth2-sample",level:4},{value:"<strong>Exposing OpenAPI defintion</strong>",id:"exposing-openapi-defintion",level:3},{value:"<strong>Disabled</strong>",id:"disabled",level:3}],d={toc:s};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"openapi-extension-reference"},"OpenAPI Extension Reference"),(0,r.kt)("p",null,"Kusk Gateway comes with an ",(0,r.kt)("a",{parentName:"p",href:"https://swagger.io/specification/#specification-extensions"},"OpenAPI extension")," to accommodate everything within\nan OpenAPI spec to create a source of truth for the operational behaviour of your API."),(0,r.kt)("p",null,"Check out the ",(0,r.kt)("a",{parentName:"p",href:"/guides/working-with-extension"},"OpenAPI Extension Guide")," to configure the operational aspects of your API."),(0,r.kt)("h2",{id:"available-properties"},(0,r.kt)("strong",{parentName:"h2"},"Available Properties")),(0,r.kt)("h3",{id:"hosts"},(0,r.kt)("strong",{parentName:"h3"},"Hosts")),(0,r.kt)("p",null,"This string array property configures the hosts (i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},"Host")," HTTP header) list the Gateway will listen traffic for. Wildcard hosts are supported in the suffix or prefix form, exclusively, i.e.:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"*.example.org"),(0,r.kt)("li",{parentName:"ul"},"example.*")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  hosts:\n    - onehost.com\n...\n")),(0,r.kt)("p",null,"Read more in the ",(0,r.kt)("a",{parentName:"p",href:"/guides/routing#using-hosts-for-multi-hosting-scenarios"},"guide on Routing"),"."),(0,r.kt)("h3",{id:"cors"},(0,r.kt)("strong",{parentName:"h3"},"CORS")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"CORS")," object sets properties for configuring ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"},"CORS")," for your API."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.origins")),(0,r.kt)("td",{parentName:"tr",align:"left"},"List of HTTP origins accepted by the configured operations.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.methods")),(0,r.kt)("td",{parentName:"tr",align:"left"},"List of HTTP methods accepted by the configured operations.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.headers")),(0,r.kt)("td",{parentName:"tr",align:"left"},"List of HTTP headers accepted by the configured operations.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.expose_headers")),(0,r.kt)("td",{parentName:"tr",align:"left"},"List of HTTP headers exposed by the configured operations.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.credentials")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Boolean flag for requiring credentials.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cors.max_age")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Indicates how long results of a preflight request can be cached.")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'...\nx-kusk:\n  cors:\n    origins:\n      - "*"\n    methods:\n      - POST\n      - GET\n      - OPTIONS\n    headers:\n      - Content-Type\n    credentials: true\n    max_age: 86200\n...\n')),(0,r.kt)("p",null,"Read more in the ",(0,r.kt)("a",{parentName:"p",href:"/guides/cors"},"guide on CORS"),"."),(0,r.kt)("h3",{id:"qos"},(0,r.kt)("strong",{parentName:"h3"},"QoS")),(0,r.kt)("p",null,"Options for configuring QoS settings, such as retries and timeouts."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"qos.retries")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Maximum number of retries (0 by default).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"qos.request_timeout")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Total request timeout (in seconds).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"qos.idle_timeout")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Timeout for idle connections (in seconds).")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  qos:\n    request_timeout: 60\n...\n")),(0,r.kt)("p",null,"Read more in the ",(0,r.kt)("a",{parentName:"p",href:"/guides/timeouts"},"guide on Timeouts"),"."),(0,r.kt)("h3",{id:"websocket"},(0,r.kt)("strong",{parentName:"h3"},"Websocket")),(0,r.kt)("p",null,'An optional boolean field that defines whether to enable handling of "Upgrade: websocket" and other actions related to Websocket HTTP headers in the request to create a Websocket tunnel to the backend. The default value is false.'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  websocket: true\n...\n")),(0,r.kt)("h3",{id:"upstream"},(0,r.kt)("strong",{parentName:"h3"},"Upstream")),(0,r.kt)("p",null,"This setting configures where the traffic goes. ",(0,r.kt)("inlineCode",{parentName:"p"},"service")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," are available and are mutually exclusive.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"upstream")," setting is mutually exclusive with ",(0,r.kt)("inlineCode",{parentName:"p"},"redirect")," setting."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"service")," is a reference to a Kubernetes Service inside the cluster, while ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," can reference any hostname, even\noutside the cluster."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/routing"},"guide on Routing")," to learn more about this functionality."),(0,r.kt)("h4",{id:"rewrite"},(0,r.kt)("strong",{parentName:"h4"},"Rewrite")),(0,r.kt)("p",null,"Additionally, ",(0,r.kt)("inlineCode",{parentName:"p"},"upstream")," has an optional object ",(0,r.kt)("inlineCode",{parentName:"p"},"rewrite"),". This allows modification of the URL of the request before forwarding\nit to the upstream service."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.rewrite.pattern")),(0,r.kt)("td",{parentName:"tr",align:null},"Regular expression.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.rewrite.substitution")),(0,r.kt)("td",{parentName:"tr",align:null},"Regular expression substitution.")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'...\nx-kusk:\n  upstream:\n    service:\n      ...\n    # /foo/bar/... -> to upstream: /bar/...\n    rewrite:\n      pattern: "^/foo"\n      substitution: ""\n...\n')),(0,r.kt)("h4",{id:"service"},(0,r.kt)("strong",{parentName:"h4"},"Service")),(0,r.kt)("p",null,"The service object sets the target Kubernetes service to receive traffic. It contains the following properties:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.service.namespace")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The namespace containing the upstream Service.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.service.name")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The upstream Service's name.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.service.port")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The upstream Service's port. Default value is 80.")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  upstream:\n    service:\n      namespace: default\n      name: svc-name\n      port: 8080\n...\n")),(0,r.kt)("h4",{id:"host"},(0,r.kt)("strong",{parentName:"h4"},"Host")),(0,r.kt)("p",null,"The host object sets the target host to receive traffic. It contains the following properties:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.host.hostname")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The hostname to route traffic to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"upstream.host.port")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The target port to route traffic to.")))),(0,r.kt)("p",null,"Note: ",(0,r.kt)("inlineCode",{parentName:"p"},"service")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," are mutually exclusive since they define the same thing (the upstream host to route to)."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  upstream:\n    host:\n      hostname: example.org\n      port: 80\n...\n")),(0,r.kt)("h3",{id:"path"},(0,r.kt)("strong",{parentName:"h3"},"Path")),(0,r.kt)("p",null,"The path object contains the following properties to configure service endpoints paths:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"path.prefix")),(0,r.kt)("td",{parentName:"tr",align:null},'Prefix for the route  ( i.e. /your-prefix/here/rest/of/the/route ). Default value is "/".')))),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"upstream.rewrite"),' option is not specified, the upstream service will receive the request "as is" with this prefix\nstill appended to the URL. If the upstream application doesn\'t know about this path, usually ',(0,r.kt)("inlineCode",{parentName:"p"},"404")," is returned."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  path:\n    prefix: /v1\n...\n")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/routing"},"guide on Routing")," to learn more about this functionality."),(0,r.kt)("h3",{id:"redirect"},(0,r.kt)("strong",{parentName:"h3"},"Redirect")),(0,r.kt)("p",null,"Configures where to redirect the request. The redirect and upstream options are mutually exclusive."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.scheme_redirect")),(0,r.kt)("td",{parentName:"tr",align:null},"Redirect scheme (http/https).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.host_redirect")),(0,r.kt)("td",{parentName:"tr",align:null},"Host to redirect to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.port_redirect")),(0,r.kt)("td",{parentName:"tr",align:null},"Port to redirect to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.path_redirect")),(0,r.kt)("td",{parentName:"tr",align:null},"Path to redirect to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.rewrite_regex.pattern")),(0,r.kt)("td",{parentName:"tr",align:null},"Regular expression (mutually exclusive with path_redirect).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.rewrite_regex.substitution")),(0,r.kt)("td",{parentName:"tr",align:null},"Regular expression substitution.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.strip_query")),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean, configures whether to strip the query from the URL (default false).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"redirect.response_code")),(0,r.kt)("td",{parentName:"tr",align:null},"Redirect response code (301, 302, 303, 307, 308).")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  redirect:\n    scheme_redirect: https\n    host_redirect: thenewhost.com\n    response_code: 302\n...\n")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/routing"},"guide on Routing")," to learn more about this functionality."),(0,r.kt)("h3",{id:"validation"},(0,r.kt)("strong",{parentName:"h3"},"Validation")),(0,r.kt)("p",null,"The validation objects contain the following properties to configure automatic request validation:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"validation.request.enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean flag to enable request validation.")))),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/validation"},"guide on Validation")," to learn more about this functionality."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  validation:\n    request:\n      enabled: true\n...\n")),(0,r.kt)("h3",{id:"mocking"},(0,r.kt)("strong",{parentName:"h3"},"Mocking")),(0,r.kt)("p",null,"The validation objects contain the following properties to configure automatic request validation:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"mocking.enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean flag to enable mocking.")))),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/guides/mocking"},"guide on Mocking")," to learn more about this functionality."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  mocking:\n    enabled: true\n...\n")),(0,r.kt)("h3",{id:"rate-limiting"},(0,r.kt)("strong",{parentName:"h3"},"Rate limiting")),(0,r.kt)("p",null,"The rate_limit object contains the following properties to configure request rate limiting:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"rate_limit.requests_per_unit")),(0,r.kt)("td",{parentName:"tr",align:null},"How many requests API can handle per unit of time.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"rate_limit.unit")),(0,r.kt)("td",{parentName:"tr",align:null},"Unit of time, can be one of the following: second, minute, hour .")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"rate_limit.per_connection")),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean flag, that specifies whether the rate limiting, should be applied per connection or in total. Default: false.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"rate_limit.response_code")),(0,r.kt)("td",{parentName:"tr",align:null},"HTTP response code, which is returned when rate limiting. Default: 429, Too Many Requests.")))),(0,r.kt)("p",null,"Note: Currently, rate limiting is applied per Envoy pod - if you have more than a single Envoy pod the total request capacity will be bigger than specified in the rate_limit object. You can check how many Envoy pods you run in the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.size")," attribute of ",(0,r.kt)("a",{parentName:"p",href:"/reference/customresources/envoyfleet"},"EnvoyFleet object"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  rate_limit:\n    requests_per_limit: 2\n    unit: minute\n...\n")),(0,r.kt)("h3",{id:"caching"},(0,r.kt)("strong",{parentName:"h3"},"Caching")),(0,r.kt)("p",null,"The cache object contains the following properties to configure HTTP caching:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cache.enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean flag to enable request validation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"cache.max_age")),(0,r.kt)("td",{parentName:"tr",align:null},"Indicates how long (in seconds) results of a request can be cached.")))),(0,r.kt)("p",null,"Note: current support for caching is experimental. Check out ","[https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/cache_filter]","(Envoy documentation) to learn more about how it works."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  cache:\n    enabled: true\n    max_age: 60\n...\n")),(0,r.kt)("h3",{id:"authentication"},(0,r.kt)("strong",{parentName:"h3"},"Authentication")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," object contains the following properties to configure HTTP authentication:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.scheme")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required"),". The authentication scheme. ",(0,r.kt)("inlineCode",{parentName:"td"},"basic"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"cloudentity")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"oauth2")," are valid values.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.path_prefix")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Optional"),". The prefix to attach to ",(0,r.kt)("inlineCode",{parentName:"td"},"auth-upstream.host.hostname"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.auth-upstream")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"basic")),". Defines the upstream authentication host.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.auth-upstream.host")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"basic")),". Defines how to reach the authentication server.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.auth-upstream.host.hostname")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"basic")),". Defines the ",(0,r.kt)("inlineCode",{parentName:"td"},"hostname")," the authentication server is running on.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.auth-upstream.host.port")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"basic")),". Defines the port the authentication server is running on, for the given ",(0,r.kt)("inlineCode",{parentName:"td"},"auth-upstream.host.hostname"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Defines the OAuth2 configuration.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.token_endpoint")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Defines the ",(0,r.kt)("inlineCode",{parentName:"td"},"token_endpoint"),", e.g., the field ",(0,r.kt)("inlineCode",{parentName:"td"},"token_endpoint")," from ",(0,r.kt)("a",{parentName:"td",href:"https://kubeshop-kusk-gateway-oauth2.eu.auth0.com/.well-known/openid-configuration"},"https://kubeshop-kusk-gateway-oauth2.eu.auth0.com/.well-known/openid-configuration"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.authorization_endpoint")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Defines the ",(0,r.kt)("inlineCode",{parentName:"td"},"authorization_endpoint"),", e.g., the field ",(0,r.kt)("inlineCode",{parentName:"td"},"authorization_endpoint")," from ",(0,r.kt)("a",{parentName:"td",href:"https://kubeshop-kusk-gateway-oauth2.eu.auth0.com/.well-known/openid-configuration"},"https://kubeshop-kusk-gateway-oauth2.eu.auth0.com/.well-known/openid-configuration"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.credentials.client_id")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Defines the Client ID.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.credentials.client_secret")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Defines the Client Secret.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.redirect_uri")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". The redirect URI passed to the authorization endpoint.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.signout_path")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". The path to sign a user out, clearing their credential cookies.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.redirect_path_matcher")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". After a redirecting the user back to the ",(0,r.kt)("inlineCode",{parentName:"td"},"redirect_uri"),", using this new grant and the ",(0,r.kt)("inlineCode",{parentName:"td"},"token_secret"),", the ",(0,r.kt)("inlineCode",{parentName:"td"},"kusk-gateway")," then attempts to retrieve an access token from the ",(0,r.kt)("inlineCode",{parentName:"td"},"token_endpoint"),". The ",(0,r.kt)("inlineCode",{parentName:"td"},"kusk-gateway")," knows it has to do this instead of reinitiating another login because the incoming request has a path that matches the ",(0,r.kt)("inlineCode",{parentName:"td"},"redirect_path_matcher")," criteria.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.forward_bearer_token")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Required, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". If the Bearer Token should be forwarded, you generally want this to be ",(0,r.kt)("inlineCode",{parentName:"td"},"true"),". When the authn server validates the client and returns an authorization token back to ",(0,r.kt)("inlineCode",{parentName:"td"},"kusk-gateway"),", no matter what format that token is, if ",(0,r.kt)("inlineCode",{parentName:"td"},"forward_bearer_token")," is set to true ",(0,r.kt)("inlineCode",{parentName:"td"},"kusk-gateway")," will send over a cookie named ",(0,r.kt)("inlineCode",{parentName:"td"},"BearerToken")," to the upstream. Additionally, the ",(0,r.kt)("inlineCode",{parentName:"td"},"Authorization")," header will be populated with the same value, i.e., Forward the OAuth token as a Bearer to upstream web service.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.auth_scopes")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Optional, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Optional list of OAuth scopes to be claimed in the authorization request. If not specified, defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"user")," scope. OAuth RFC ",(0,r.kt)("a",{parentName:"td",href:"https://tools.ietf.org/html/rfc6749#section-3.3"},"https://tools.ietf.org/html/rfc6749#section-3.3"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"auth.oauth2.resources")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"td"},"Optional, if ",(0,r.kt)("inlineCode",{parentName:"strong"},"scheme")," is ",(0,r.kt)("inlineCode",{parentName:"strong"},"oauth2")),". Optional list of resource parameters for authorization request RFC: ",(0,r.kt)("a",{parentName:"td",href:"https://tools.ietf.org/html/rfc8707"},"https://tools.ietf.org/html/rfc8707"),".")))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"auth.auth-upstream")," (named as ",(0,r.kt)("inlineCode",{parentName:"p"},"basic")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"cloudentity"),") are mutually exclusive with ",(0,r.kt)("inlineCode",{parentName:"p"},"oauth2"),": The two cannot be specified together."),(0,r.kt)("h4",{id:"references"},"References"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"More information about the ",(0,r.kt)("inlineCode",{parentName:"li"},"basic")," configuration can be found at ",(0,r.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_authz_filter"},(0,r.kt)("inlineCode",{parentName:"a"},"External Authorization \u2014 envoy")),"."),(0,r.kt)("li",{parentName:"ul"},"More information about the ",(0,r.kt)("inlineCode",{parentName:"li"},"oauth2")," configuration can be found at ",(0,r.kt)("a",{parentName:"li",href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/oauth2_filter"},(0,r.kt)("inlineCode",{parentName:"a"},"OAuth2 \u2014 envoy")),".")),(0,r.kt)("h4",{id:"basic-sample"},(0,r.kt)("inlineCode",{parentName:"h4"},"basic")," Sample"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n...\n  auth:\n    scheme: basic\n    path_prefix: /login # optional\n    auth-upstream:\n      host:\n        hostname: example.com\n        port: 80\n...\n")),(0,r.kt)("h4",{id:"oauth2-sample"},(0,r.kt)("inlineCode",{parentName:"h4"},"oauth2")," Sample"),(0,r.kt)("p",null,"The example below ensures the whole API is protected via OAuth2."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"api.yml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n  auth:\n    scheme: oauth2\n    oauth2:\n      token_endpoint: *TOKEN_ENDPOINT* # <- for example https://yourdomain.eu.auth0.com/oauth/token\n      authorization_endpoint: *AUTHORIZATION_ENDPOINT* # <- for example https://yourdomain.eu.auth0.com/authorize\n      credentials:\n        client_id: *CLIENT_ID*\n        client_secret: *CLIENT_SECRET*\n      redirect_uri: /oauth2/callback\n      redirect_path_matcher: /oauth2/callback\n      signout_path: /oauth2/signout\n      forward_bearer_token: true\n      auth_scopes:\n        - openid\n...\n")),(0,r.kt)("h3",{id:"exposing-openapi-defintion"},(0,r.kt)("strong",{parentName:"h3"},"Exposing OpenAPI defintion")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"openapi-path")," field takes a path name and will expose your OpenAPI definition at the defined path."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\nx-kusk:\n openapi-path: openapi.json\n...\n")),(0,r.kt)("p",null,"This will expose your entire OpenAPI definition, without the Kusk extensions, on ",(0,r.kt)("inlineCode",{parentName:"p"},"yourdomain.com/openapi.json"),"."),(0,r.kt)("p",null,"To remove some paths or operations from the exposed OpenAPI, use the ",(0,r.kt)("a",{parentName:"p",href:"./#disabled"},(0,r.kt)("inlineCode",{parentName:"a"},"disabled")," option"),"."),(0,r.kt)("h3",{id:"disabled"},(0,r.kt)("strong",{parentName:"h3"},"Disabled")),(0,r.kt)("p",null,'This boolean property allows you to disable the corresponding path/operation, "hiding" internal operations from being published to end users.'),(0,r.kt)("p",null,"When set to true at the top level, all paths will be hidden; you will have to override specific paths/operations with\n",(0,r.kt)("inlineCode",{parentName:"p"},"disabled: false")," to make those operations visible."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n  /path:\n    x-kusk:\n      disabled: true\n...\n")))}m.isMDXComponent=!0}}]);