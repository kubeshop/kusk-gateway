"use strict";(self.webpackChunkkusk_gateway_docs_2=self.webpackChunkkusk_gateway_docs_2||[]).push([[241],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=i.createContext({}),s=function(e){var t=i.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=s(e.components);return i.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(n),h=o,y=p["".concat(u,".").concat(h)]||p[h]||d[h]||a;return n?i.createElement(y,r(r({ref:t},c),{},{components:n})):i.createElement(y,r({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=p;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},31139:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var i=n(87462),o=(n(67294),n(3905));const a={},r="Cloudentity",l={unversionedId:"guides/authentication/cloudentity",id:"guides/authentication/cloudentity",title:"Cloudentity",description:"Kusk Gateway enables using third-party authentication and authorization management solutions such as Cloudentity.",source:"@site/docs/guides/authentication/cloudentity.md",sourceDirName:"guides/authentication",slug:"/guides/authentication/cloudentity",permalink:"/guides/authentication/cloudentity",draft:!1,editUrl:"https://github.com/kubeshop/kusk-gateway/docs/guides/authentication/cloudentity.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OAuth2 via OIDC",permalink:"/guides/authentication/oauth2"},next:{title:"CORS Settings",permalink:"/guides/cors"}},u={},s=[{value:"Setup guide",id:"setup-guide",level:2},{value:"1. Create Kusk Authorizer in Cloudentity",id:"1-create-kusk-authorizer-in-cloudentity",level:3},{value:"2. Install Cloudentity&#39;s authorizer in your cluster",id:"2-install-cloudentitys-authorizer-in-your-cluster",level:3},{value:"3. Deploy an API with Kusk that uses Cloudentiy&#39;s authorizer",id:"3-deploy-an-api-with-kusk-that-uses-cloudentiys-authorizer",level:3},{value:"4. Add an API Authorization Policy with Cloudentity",id:"4-add-an-api-authorization-policy-with-cloudentity",level:3},{value:"5. Test that API calls are blocked",id:"5-test-that-api-calls-are-blocked",level:3}],c={toc:s};function d(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,i.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"cloudentity"},"Cloudentity"),(0,o.kt)("p",null,"Kusk Gateway enables using third-party authentication and authorization management solutions such as Cloudentity."),(0,o.kt)("p",null,"Developers can utilize Cloudentity's platform to control their authorization flows while still using OpenAPI with Kusk to configure gateway level rules."),(0,o.kt)("p",null,"This separation of concerns is important when your authorization flow complexity grows or the number of services talking to each other require more authorization granularity."),(0,o.kt)("h2",{id:"setup-guide"},"Setup guide"),(0,o.kt)("p",null,"By the end of this guide, you will have deployed an API to Kusk and used Cloudentity to block requests to your API. "),(0,o.kt)("h3",{id:"1-create-kusk-authorizer-in-cloudentity"},"1. Create Kusk Authorizer in Cloudentity"),(0,o.kt)("p",null,"On Cloudentity's platform, go to ",(0,o.kt)("strong",{parentName:"p"},"Enforcement > Authorizers"),", click ",(0,o.kt)("strong",{parentName:"p"},"CREATE GATEWAY"),", and from the list that's displayed choose Kusk."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"cloudentity authorizers list",src:n(66734).Z,width:"1237",height:"757"})),(0,o.kt)("h3",{id:"2-install-cloudentitys-authorizer-in-your-cluster"},"2. Install Cloudentity's authorizer in your cluster"),(0,o.kt)("p",null,"The bottom of the quickstart section contains a ",(0,o.kt)("inlineCode",{parentName:"p"},"helm")," command that installs Cloudentity's authorizer and configures it with credentials that are used to pull authorization policies from Cloudentity. "),(0,o.kt)("p",null,'Be sure to click on "Show" before copying the command so it can copy the credentials with the ',(0,o.kt)("inlineCode",{parentName:"p"},"helm")," command."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"cloudentity helm command",src:n(63521).Z,width:"1308",height:"375"})),(0,o.kt)("p",null,"Once copied, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"helm")," command in your terminal. "),(0,o.kt)("p",null,"You can check the installation of the authorizer with: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl get svc -A\nNAMESPACE     NAME                                           TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\n...\ncloudentity-authorizer-standalone-authorizer   ClusterIP      10.96.216.20    <none>        9004/TCP                     3h12m\n...\n")),(0,o.kt)("h3",{id:"3-deploy-an-api-with-kusk-that-uses-cloudentiys-authorizer"},"3. Deploy an API with Kusk that uses Cloudentiy's authorizer"),(0,o.kt)("p",null,"This is an example that uses a Kusk Policy with your OpenAPI definition to configure your gateway to use Cloudentity's authorizer with Kusk's mocking policy: "),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cloudentity-api.yaml")," "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"openapi: 3.0.0\ninfo:\n  title: super-simple\n  description: super simple api\n  version: '0.1.0'\nx-kusk:\n  mocking:\n    enabled: true\n  auth:\n    scheme: cloudentity\n    auth-upstream:\n      host:\n        hostname: cloudentity-authorizer-standalone-authorizer.kusk-system # default authorizer service, change in case your authorizer is installed differently\n        port: 9004\npaths:\n  /hello:\n    get:\n      responses:\n        200:\n          description: Return a hello world message\n          content: \n            application/json:\n              schema:\n                type: object\n                properties:\n                  message:\n                    type: string\n              example:\n                message: Mocked Response! \n")),(0,o.kt)("p",null,"Create the file and deploy it to your cluster: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kusk deploy -i cloudentity-api.yaml\n")),(0,o.kt)("p",null,"Without any additional configuration, you should be able to call the API without it being blocked and Kusk will return a mock response as configured in the example field: "),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Cloudentity's authorizer pulls new rules on an interval of 1 minute. During that period after the initial confiugration your will receive responses with HTTP Status Code ",(0,o.kt)("inlineCode",{parentName:"p"},"403"),". ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl $(kusk ip)\n\n{"message":"Mocked Response!"}\n')),(0,o.kt)("h3",{id:"4-add-an-api-authorization-policy-with-cloudentity"},"4. Add an API Authorization Policy with Cloudentity"),(0,o.kt)("p",null,"To see a simple example of how Cloudentity blocks an API, configure the simple authorization policy ",(0,o.kt)("strong",{parentName:"p"},'"Block API"')," with cloudentity to block all API calls. "),(0,o.kt)("p",null,"For that, on Cloudentity's portal, navigate to ",(0,o.kt)("strong",{parentName:"p"},"Enforcement > APIs")," where you'll see the list of paths that Kusk has synchronized with your Cloudentity's account."),(0,o.kt)("p",null,"Click on the policy column to add a ",(0,o.kt)("strong",{parentName:"p"},"Block API")," rule. "),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"cloudentity policy selection",src:n(13381).Z,width:"1056",height:"752"})),(0,o.kt)("h3",{id:"5-test-that-api-calls-are-blocked"},"5. Test that API calls are blocked"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl $(kusk ip) -v\n...\n< HTTP/1.1 403 Forbidden\n< date: Tue, 04 Oct 2022 06:54:52 GMT\n< x-envoy-upstream-service-time: 9\n< server: envoy\n< content-length: 0\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Cloudentity's authorizer pulls new rules on an interval of 1 minute. During that period, your API calls will work with the old rules until the new ones are pulled. ")))}d.isMDXComponent=!0},66734:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/cloudentity-authorizers-e8201e1c37201e3d00573ba5b4a7fb95.png"},63521:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/cloudentity-helm-command-bd30aaaf86dc00ff135cd21db44f00e5.png"},13381:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/cloudentity-policy-selection-65b7a088bd131766f39e5ffb813b9a73.png"}}]);