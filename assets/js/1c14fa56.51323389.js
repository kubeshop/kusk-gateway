"use strict";(self.webpackChunkkusk_gateway_docs_2=self.webpackChunkkusk_gateway_docs_2||[]).push([[344],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},p=Object.keys(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,p=e.originalType,o=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=s(n),d=r,k=c["".concat(o,".").concat(d)]||c[d]||u[d]||p;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var p=n.length,i=new Array(p);i[0]=c;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<p;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3886:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>p,metadata:()=>l,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const p={},i="Generating API CRDs",l={unversionedId:"cli/generate-cmd",id:"cli/generate-cmd",title:"Generating API CRDs",description:"The generate command accepts your OpenAPI definition as input, either as a local file or a URL pointing to your file",source:"@site/docs/cli/generate-cmd.md",sourceDirName:"cli",slug:"/cli/generate-cmd",permalink:"/kusk-gateway/cli/generate-cmd",draft:!1,editUrl:"https://github.com/kubeshop/kusk-gateway/docs/cli/generate-cmd.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Mock your API locally using Kusk",permalink:"/kusk-gateway/cli/mock-cmd"},next:{title:"Accessing the Kusk Gateway Dashboard",permalink:"/kusk-gateway/cli/dashboard-cmd"}},o={},s=[{value:"<strong>Usage</strong>",id:"usage",level:4},{value:"<strong>Example</strong>",id:"example",level:4},{value:"<strong>Arguments</strong>",id:"arguments",level:4}],m={toc:s};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"generating-api-crds"},"Generating API CRDs"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"generate")," command accepts your OpenAPI definition as input, either as a local file or a URL pointing to your file\nand generates a Kusk Gateway compatible API resource that you can apply directly into your cluster. Use this command to automate\nAPI deployment workflows from an existing OpenAPI definition. "),(0,r.kt)("p",null,"Configuration of the API resource is done via the ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk")," extension."),(0,r.kt)("p",null,"If the OpenAPI definition doesn't have a top-level ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk")," property set, it will add them for you and set\nthe upstream service, namespace and port to the flag values passed, respectively, and set the rest of the settings to defaults.\nThis is enough to get you started."),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk")," extension is already present, it will override the upstream service, namespace and port to the flag values passed, respectively,\nand leave the rest of the settings as they are."),(0,r.kt)("p",null,"You must specify the name of the EnvoyFleet you wish to use to expose your API. Kusk Gateway could be managing more than one.\nIn the future, we will add a ",(0,r.kt)("inlineCode",{parentName:"p"},"default EnvoyFleet")," which Kusk Gateway will use when none is specified. i.e., ",(0,r.kt)("inlineCode",{parentName:"p"},"kusk-gateway-envoy-fleet"),"."),(0,r.kt)("p",null,"If you do not specify the EnvoyFleet namespace, it will default to ",(0,r.kt)("inlineCode",{parentName:"p"},"kusk-system"),"."),(0,r.kt)("h4",{id:"usage"},(0,r.kt)("strong",{parentName:"h4"},"Usage")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"No name specified:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kusk api generate \\\n  -i spec.yaml \\\n  --envoyfleet.name kusk-gateway-envoy-fleet \\\n  --envoyfleet.namespace kusk-system\n")),(0,r.kt)("p",null,"In the above example, Kusk will use the OpenAPI definition ",(0,r.kt)("inlineCode",{parentName:"p"},"info.title")," property to generate a manifest name and\nleave the existing ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk")," extension settings."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"No api namespace specified:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kusk api generate \\\n  -i spec.yaml \\\n  --name httpbin-api \\\n  --upstream.service httpbin \\\n  --upstream.port 8080 \\\n  --envoyfleet.name kusk-gateway-envoy-fleet\n")),(0,r.kt)("p",null,"In the above example, as ",(0,r.kt)("inlineCode",{parentName:"p"},"--namespace")," isn't defined, the default namespace will be used."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Namespace specified:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kusk api generate \\\n  -i spec.yaml \\\n  --name httpbin-api \\\n  --upstream.service httpbin \\\n  --upstream.namespace my-namespace \\\n  --upstream.port 8080 \\\n  --envoyfleet.name kusk-gateway-envoy-fleet\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"OpenAPI definition from URL:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kusk api generate \\\n    -i https://raw.githubusercontent.com/$ORG_OR_USER/$REPO/myspec.yaml \\\n    --name httpbin-api \\\n    --upstream.service httpbin \\\n    --upstream.namespace my-namespace \\\n    --upstream.port 8080 \\\n    --envoyfleet.name kusk-gateway-envoy-fleet\n")),(0,r.kt)("p",null,"This will fetch the OpenAPI document from the provided URL and generate a Kusk Gateway API resource."),(0,r.kt)("h4",{id:"example"},(0,r.kt)("strong",{parentName:"h4"},"Example")),(0,r.kt)("p",null,"Take a look at the ",(0,r.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/kubeshop/kusk-gateway/main/examples/httpbin/httpbin-spec.yaml"},"http-bin example spec"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\nkusk api generate -i https://raw.githubusercontent.com/kubeshop/kusk-gateway/main/examples/httpbin/httpbin-spec.yaml --name httpbin-api --upstream.service httpbin --upstream.port 8080 --envoyfleet.name kusk-gateway-envoy-fleet\n")),(0,r.kt)("p",null,"The output should contain the following x-kusk extension at the top level:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'...\nx-kusk:\n  cors: {}\n  path:\n    rewrite:\n      pattern: ""\n      substitution: ""\n  upstream:\n    service:\n    name: httpbin\n    namespace: default\n    port: 8080\n')),(0,r.kt)("h4",{id:"arguments"},(0,r.kt)("strong",{parentName:"h4"},"Arguments")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Argument"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Required?"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--name")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The name to give the API resource e.g. --name my-api. Otherwise, taken from OpenAPI info title field."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--namespace")," / ",(0,r.kt)("inlineCode",{parentName:"td"},"-n")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The namespace of the API resource e.g. --namespace my-namespace, -n my-namespace (default: default)."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--in")," / ",(0,r.kt)("inlineCode",{parentName:"td"},"-i")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The file path or URL to OpenAPI definition to generate mappings from. e.g. --in apispec.yaml."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--upstream.service")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The name of upstream Kubernetes service."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--upstream.namespace")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The namespace of upstream service (default: default)."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--upstream.port")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The port that upstream service is exposed on (default: 80)."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"--envoyfleet.name")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The name of envoyfleet to use for this API."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"envoyfleet.namespace")),(0,r.kt)("td",{parentName:"tr",align:"left"},"The namespace of envoyfleet to use for this API. Default: kusk-system."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")))))}u.isMDXComponent=!0}}]);