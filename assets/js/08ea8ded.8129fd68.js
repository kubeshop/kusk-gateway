"use strict";(self.webpackChunkkusk_gateway_docs_2=self.webpackChunkkusk_gateway_docs_2||[]).push([[6601],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(n),u=r,k=m["".concat(p,".").concat(u)]||m[u]||d[u]||i;return n?o.createElement(k,a(a({ref:t},c),{},{components:n})):o.createElement(k,a({ref:t},c))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var s=2;s<i;s++)a[s]=n[s];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},32770:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var o=n(87462),r=(n(67294),n(3905));const i={},a="Response Mocking",l={unversionedId:"guides/mocking",id:"guides/mocking",title:"Response Mocking",description:"How can Mocking help?",source:"@site/docs/guides/mocking.md",sourceDirName:"guides",slug:"/guides/mocking",permalink:"/guides/mocking",draft:!1,editUrl:"https://github.com/kubeshop/kusk-gateway/docs/guides/mocking.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CORS Settings",permalink:"/guides/cors"},next:{title:"Request Validation",permalink:"/guides/validation"}},p={},s=[{value:"<strong>How can Mocking help?</strong>",id:"how-can-mocking-help",level:2},{value:"<strong>How does Mocking work?</strong>",id:"how-does-mocking-work",level:2},{value:"<strong>Mocking Example</strong>",id:"mocking-example",level:2}],c={toc:s};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"response-mocking"},"Response Mocking"),(0,r.kt)("h2",{id:"how-can-mocking-help"},(0,r.kt)("strong",{parentName:"h2"},"How can Mocking help?")),(0,r.kt)("p",null,"Mocking is an integral part of the API lifecycle. Providing mocks can help both API consumers (for example, FE/Mobile app developers) and\ntesters to bootstrap their efforts without being dependent on the actual implementation of an API being available. It can also help prototype\nAPI integrations and validate API designs with end-users before actually implementing them."),(0,r.kt)("h2",{id:"how-does-mocking-work"},(0,r.kt)("strong",{parentName:"h2"},"How does Mocking work?")),(0,r.kt)("p",null,"Kusk Gateway makes mocking of your APIs extremely easy; simply add the ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk.mocking")," property to your API (globally or at any other level)\nto enable the mocking of responses using the examples provided in an OpenAPI definition - ",(0,r.kt)("a",{parentName:"p",href:"https://swagger.io/specification/#example-object"},"examples object"),"."),(0,r.kt)("p",null,"Either ",(0,r.kt)("inlineCode",{parentName:"p"},"example:")," (singular) or ",(0,r.kt)("inlineCode",{parentName:"p"},"examples:")," (plural) are supported, however with multiple objects in ",(0,r.kt)("inlineCode",{parentName:"p"},"examples"),", the response will include only one from that object map.\nIf both are specified, singular (",(0,r.kt)("inlineCode",{parentName:"p"},"example"),") has the priority over plural."),(0,r.kt)("p",null,"Examples are defined as a part of the response HTTP code and its contents' media-type (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"application/json"),") and could be different for the different media types."),(0,r.kt)("p",null,'As part of the mocked response, the related HTTP code is returned, but only success codes are supported for the mocking. For example, 200 and 201, but not 400, 404 or 500.\nThough the OpenAPI standard allows the response code to be a range or a wildcard (e.g. "2xx"), we need to know exactly what code to return, so this should be specified exactly as integer compatible ("200").\nIn case the response doesn\'t have the response schema, only the single http code is used to mock the response, the body is not returned.\nThis is useful to test, for example, DELETE or PATCH operations that don\'t produce the body.'),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"mocking")," is inheritable - if it is specified on the path or root level it will include every operation below it.\nIn case there are responses without the response schema but with the examples, these must be explicitly disabled with ",(0,r.kt)("inlineCode",{parentName:"p"},"mocking.enabled: false"),", otherwise the configuration submission will fail."),(0,r.kt)("p",null,"Note: Currently ",(0,r.kt)("inlineCode",{parentName:"p"},"mocking")," is incompatible with the ",(0,r.kt)("inlineCode",{parentName:"p"},"validation")," option, the configuration deployment will fail if both are enabled."),(0,r.kt)("h2",{id:"mocking-example"},(0,r.kt)("strong",{parentName:"h2"},"Mocking Example")),(0,r.kt)("p",null,"Consider the following operation in an OpenAPI definition:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'      /mocked/{id}:\n        # Enable mocking with x-kusk\n        # Will enable mocking for all HTTP operations below\n        x-kusk:\n          mocking:\n            enabled: true\n        get:\n          responses:\n            # This HTTP code will be returned.\n            \'200\':\n              description: \'Mocked ToDos\'\n              content:\n                application/json:\n                  schema:\n                    type: object\n                    properties:\n                      title:\n                        type: string\n                        description: Description of what to do\n                      completed:\n                        type: boolean\n                      order:\n                        type: integer\n                        format: int32\n                      url:\n                        type: string\n                    required:\n                      - title\n                      - completed\n                      - order\n                      - url\n                  # Singular example has the priority over other examples.\n                  example:\n                    title: "Mocked JSON title"\n                    completed: true\n                    order: 13\n                    url: "http://mockedURL.com"\n                  examples:\n                    first:\n                      title: "Mocked JSON title #1"\n                      completed: true\n                      order: 12\n                      url: "http://mockedURL.com"\n                    second:\n                      title: "Mocked JSON title #2"\n                      completed: true\n                      order: 13\n                      url: "http://mockedURL.com"\n                application/xml:\n                  example:\n                    title: "Mocked XML title"\n                    completed: true\n                    order: 13\n                    url: "http://mockedURL.com"\n                text/plain:\n                  example: |\n                    title: "Mocked Text title"\n                    completed: true\n                    order: 13\n                    url: "http://mockedURL.com"\n        patch:\n          # Disable for patch\n          x-kusk:\n            mocking:\n              enabled: false\n        ...\n')),(0,r.kt)("p",null,"With the example above, the response to the GET request will be different depending on the client's preferred media type when using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Accept")," header."),(0,r.kt)("p",null,"Below, we're using the example.com setup from the development/testing directory."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Curl call without specifying the ",(0,r.kt)("strong",{parentName:"p"},"Accept")," header:"),(0,r.kt)("p",{parentName:"li"}," From the list of specified media types (application/json, plain/text, application/xml), this example uses our default Mocking media type - application/json:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v -H "Host: example.com" http://192.168.49.3/testing/mocked/multiple/1\n\n< HTTP/1.1 200 OK\n< content-type: application/json\n< x-kusk-mocked: true\n< date: Mon, 21 Feb 2022 14:36:52 GMT\n< content-length: 81\n< x-envoy-upstream-service-time: 0\n< server: envoy\n< \n{"completed":true,"order":13,"title":"Mocked JSON title","url":"http://mockedURL.com"}\n')),(0,r.kt)("p",{parentName:"li"},"The response includes the ",(0,r.kt)("inlineCode",{parentName:"p"},"x-kusk-mocked: true")," header indicating mocking.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"With the ",(0,r.kt)("strong",{parentName:"p"},"Accept")," header, that has application/xml as the preferred type:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v -H "Host: example.com" -H "Accept: application/xml"  http://192.168.49.3/testing/mocked/1\n< HTTP/1.1 200 OK\n< content-type: application/xml\n< x-kusk-mocked: true\n< date: Mon, 28 Feb 2022 08:56:46 GMT\n< content-length: 117\n< x-envoy-upstream-service-time: 0\n< server: envoy\n\n<doc><completed>true</completed><order>13</order><title>Mocked XML title</title><url>http://mockedURL.com</url></doc>\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"With the ",(0,r.kt)("strong",{parentName:"p"},"Accept")," header specifying multiple weighted preferred media types, text/plain with more weight."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -v -H "Host: example.com" -H "Accept: application/json;q=0.8,text/plain;q=0.9"  http://192.168.49.3/testing/mocked/1\n< content-type: text/plain\n< x-kusk-mocked: true\n< date: Mon, 28 Feb 2022 08:56:00 GMT\n< content-length: 81\n< x-envoy-upstream-service-time: 0\n< server: envoy\n< \ntitle: "Mocked Text title"\ncompleted: true\norder: 13\nurl: "http://mockedURL.com"\n\n')))))}d.isMDXComponent=!0}}]);